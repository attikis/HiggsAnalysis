#!/bin/tcsh

# write name of datacard here
# remove .txt
#---set filename = HPlusHadronic_120
#HPlusHadronic_120.txt
#HPlusHadronic_ltau_120_combined
#HPlusHadronic_ltau_emu_120_combined
set name = HPlusHadronic

while (`bjobs -w |& grep $name` != "") # check if job name exists
  echo Waiting for previous jobs to end.  You might want to bkill these jobs...
  sleep 10
end

set f1 = ${name}_80
set f2 = ${name}_100
set f3 = ${name}_120
set f4 = ${name}_140
set f5 = ${name}_150
set f6 = ${name}_155
set f7 = ${name}_160

set j1 = ${name}_80
set j2 = ${name}_100
set j3 = ${name}_120
set j4 = ${name}_140
set j5 = ${name}_150
set j6 = ${name}_155
set j7 = ${name}_160

set odir = `pwd`
set outputfile = output_LandS_`basename ${name} .txt`

# generates the files output_LandS_HPlusHadronic_*_obs
# bsub -q cmscaf1nd -J ${name}_80 ${odir}/script_run_LandS_obs ${odir} HPlusHadronic_80.txt
# bsub -q cmscaf1nd -J ${name}_100 ${odir}/script_run_LandS_obs ${odir} HPlusHadronic_100.txt
bsub -q cmscaf1nd -J ${j1}_o ${odir}/script_run_LandS_obs ${odir} ${f1}.txt
bsub -q cmscaf1nd -J ${j3}_o ${odir}/script_run_LandS_obs ${odir} ${f3}.txt
# bsub -q cmscaf1nd -J ${name}_140 ${odir}/script_run_LandS_obs ${odir} HPlusHadronic_140.txt
# bsub -q cmscaf1nd -J ${name}_150 ${odir}/script_run_LandS_obs ${odir} HPlusHadronic_150.txt
# bsub -q cmscaf1nd -J ${name}_155 ${odir}/script_run_LandS_obs ${odir} HPlusHadronic_155.txt
# bsub -q cmscaf1nd -J ${name}_160 ${odir}/script_run_LandS_obs ${odir} HPlusHadronic_160.txt

# generates the files output_LandS_HPlusHadronic_*_obs
# bsub -q cmscaf1nd -J ${name}_80 ${odir}/script_run_LandS_exp ${odir} HPlusHadronic_80.txt
# bsub -q cmscaf1nd -J ${name}_100 ${odir}/script_run_LandS_exp ${odir} HPlusHadronic_100.txt
bsub -q cmscaf1nd -J ${j1}_e ${odir}/script_run_LandS_exp ${odir} ${f1}.txt
bsub -q cmscaf1nd -J ${j3}_e ${odir}/script_run_LandS_exp ${odir} ${f3}.txt
# bsub -q cmscaf1nd -J ${name}_140 ${odir}/script_run_LandS_exp ${odir} HPlusHadronic_140.txt
# bsub -q cmscaf1nd -J ${name}_150 ${odir}/script_run_LandS_exp ${odir} HPlusHadronic_150.txt
# bsub -q cmscaf1nd -J ${name}_155 ${odir}/script_run_LandS_exp ${odir} HPlusHadronic_155.txt
# bsub -q cmscaf1nd -J ${name}_160 ${odir}/script_run_LandS_exp ${odir} HPlusHadronic_160.txt

echo Checking jobs with name $name.
while (`bjobs -w |& grep $name` != "") # check if job name exists
  echo Waiting for jobs to end `date`
  sleep 30
end

set output1 = output_LandS_${f1}
set output2 = output_LandS_${f2}
set output3 = output_LandS_${f3}
set output4 = output_LandS_${f4}
set output5 = output_LandS_${f5}
set output6 = output_LandS_${f6}
set output7 = output_LandS_${f7}

# collect observed values
# head -3 output_LandS_HPlusHadronic_80_obs | tail -1 | awk '{print $12 }' >&! output_LandS_HPlusHadronic_80
# head -3 output_LandS_HPlusHadronic_100_obs | tail -1 | awk '{print $12 }' >&! output_LandS_HPlusHadronic_100
#head -3 ${outputfile}_obs | tail -1 | awk '{print $12 }' >&! ${outputfile}
head -3 ${output1}_obs | tail -1 | awk '{print $12 }' >&! ${output1}
head -3 ${output3}_obs | tail -1 | awk '{print $12 }' >&! ${output3}
# head -3 output_LandS_HPlusHadronic_140_obs | tail -1 | awk '{print $12 }' >&! output_LandS_HPlusHadronic_140
# head -3 output_LandS_HPlusHadronic_150_obs | tail -1 | awk '{print $12 }' >&! output_LandS_HPlusHadronic_150
# head -3 output_LandS_HPlusHadronic_155_obs | tail -1 | awk '{print $12 }' >&! output_LandS_HPlusHadronic_155
# head -3 output_LandS_HPlusHadronic_160_obs | tail -1 | awk '{print $12 }' >&! output_LandS_HPlusHadronic_160

# head -3 output_LandS_HPlusHadronic_80_exp | tail -1 | awk '{print $2 " " $3 " " $7 " " $5 " " $6}' >> output_LandS_HPlusHadronic_80
# head -3 output_LandS_HPlusHadronic_100_exp | tail -1 | awk '{print $2 " " $3 " " $7 " " $5 " " $6}' >> output_LandS_HPlusHadronic_100
#head -3 ${outputfile}_exp | tail -1 | awk '{print $2 " " $3 " " $7 " " $5 " " $6}' >> ${outputfile}
head -3 ${output1}_exp | tail -1 | awk '{print $2 " " $3 " " $7 " " $5 " " $6}' >> ${output1}
head -3 ${output3}_exp | tail -1 | awk '{print $2 " " $3 " " $7 " " $5 " " $6}' >> ${output3}
# head -3 output_LandS_HPlusHadronic_140_exp | tail -1 | awk '{print $2 " " $3 " " $7 " " $5 " " $6}' >> output_LandS_HPlusHadronic_140
# head -3 output_LandS_HPlusHadronic_150_exp | tail -1 | awk '{print $2 " " $3 " " $7 " " $5 " " $6}' >> output_LandS_HPlusHadronic_150
# head -3 output_LandS_HPlusHadronic_155_exp | tail -1 | awk '{print $2 " " $3 " " $7 " " $5 " " $6}' >> output_LandS_HPlusHadronic_155
# head -3 output_LandS_HPlusHadronic_160_exp | tail -1 | awk '{print $2 " " $3 " " $7 " " $5 " " $6}' >> output_LandS_HPlusHadronic_160

#ls ${odir}/output_LandS_*
cd ${odir}
ls -al output_LandS_*

echo Ready!
